<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<title></title>
	</head>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
	<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
	<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	<script src="//code.highcharts.com/highcharts.js"></script>
	<script>

		var dashboardData;
		function update() {
//			$('#startModal').modal('show');

			$.ajax({
				url: 'https://coscup.cprteam.org/dashboard',
				type: 'GET',
				dataType: "JSON",
				success: function (json) {
					console.log("Response:");
					console.log(json);
					dashboardData = json;

					draw_day1checkinChart();
					draw_kitChart();
					draw_day1lunchChart();

					draw_day2checkinChart();
					draw_day2lunchChart();
				},
				error: function(e){
					console.log("ERROR:");
					console.log(e);
				}
			}).always(function() {
//				$('#startModal').modal('hide');
			});
		}

		Highcharts.setOptions({
			 colors: ['#3D983C', '#CCCCCC']
			});

		var day1checkinChart;
		function draw_day1checkinChart() {
			if (!$.isEmptyObject(day1checkinChart)) {
				day1checkinChart.series[0].setData([
					{
						name: '已報到',
						y: dashboardData.day1checkin_used,
						sliced: true,
						selected: true
					},
					['未報到', (dashboardData.total - dashboardData.day1checkin_used)]
			    ], true);
			}
			else {
				day1checkinChart = new Highcharts.Chart({
					chart: {
						renderTo: 'day1checkin_chart',
						plotBackgroundColor: null,
						plotBorderWidth: null,
						plotShadow: false
					},
					title: {
						text: '報到狀態<br/>共 ' + dashboardData.total + ' 名會眾'
					},
					tooltip: {
						pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
					},
					plotOptions: {
						pie: {
							allowPointSelect: false,
							cursor: 'pointer',
							dataLabels: {
								enabled: true,
								formatter: function() {
									return this.y + ' ( ' + Math.round(this.percentage*100)/100 + '% )';
								},
								distance: -50
							},
							showInLegend: true
						}
					},
					series: [{
						type: 'pie',
						name: 'Percentage：',
						data: [
							{
								name: '已報到',
								y: dashboardData.day1checkin_used,
								sliced: true,
								selected: true
							},
							['未報到', (dashboardData.total - dashboardData.day1checkin_used)]
						]
					}]
				});
			}
		}


		var kitChart;
		function draw_kitChart() {
			if (!$.isEmptyObject(kitChart)) {
				kitChart.series[0].setData([
					{
						name: '已領取',
						y: dashboardData.kit_used,
						sliced: true,
						selected: true
					},
					['未領取', (dashboardData.total - dashboardData.kit_used)]
			    ], true);
			}
			else {
				kitChart = new Highcharts.Chart({
					chart: {
						renderTo: 'kit_chart',
						plotBackgroundColor: null,
						plotBorderWidth: null,
						plotShadow: false
					},
					title: {
						text: '迎賓袋<br/>'
					},
					tooltip: {
						pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
					},
					plotOptions: {
						pie: {
							allowPointSelect: false,
							cursor: 'pointer',
							dataLabels: {
								enabled: true,
								formatter: function() {
									return this.y + ' ( ' + Math.round(this.percentage*100)/100 + '% )';
								},
								distance: -50
							},
							showInLegend: true
						}
					},
					series: [{
						type: 'pie',
						name: 'Percentage：',
						data: [
							{
								name: '已領取',
								y: dashboardData.kit_used,
								sliced: true,
								selected: true
							},
							['未領取', (dashboardData.total - dashboardData.kit_used)]
						]
					}]
				});
			}
		}

		var day1lunchChart;
		function draw_day1lunchChart() {
			if (!$.isEmptyObject(day1lunchChart)) {
				day1lunchChart.series[0].setData([
					{
						name: '已領取',
						y: dashboardData.day1lunch_used,
						sliced: true,
						selected: true
					},
					['未領取', (dashboardData.total - dashboardData.day1lunch_used)]
			    ], true);
			}
			else {
				day1lunchChart = new Highcharts.Chart({
					chart: {
						renderTo: 'day1lunch_chart',
						plotBackgroundColor: null,
						plotBorderWidth: null,
						plotShadow: false
					},
					title: {
						text: '午餐<br/>'
					},
					tooltip: {
						pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
					},
					plotOptions: {
						pie: {
							allowPointSelect: false,
							cursor: 'pointer',
							dataLabels: {
								enabled: true,
								formatter: function() {
									return this.y + ' ( ' + Math.round(this.percentage*100)/100 + '% )';
								},
								distance: -50
							},
							showInLegend: true
						}
					},
					series: [{
						type: 'pie',
						name: 'Percentage：',
						data: [
							{
								name: '已領取',
								y: dashboardData.day1lunch_used,
								sliced: true,
								selected: true
							},
							['未領取', (dashboardData.total - dashboardData.day1lunch_used)]
						]
					}]
				});
			}
		}


		var day2checkinChart;
		function draw_day2checkinChart() {
			if (!$.isEmptyObject(day2checkinChart)) {
				day2checkinChart.series[0].setData([
					{
						name: '已報到',
						y: dashboardData.day2checkin_used,
						sliced: true,
						selected: true
					},
					['未報到', (dashboardData.total - dashboardData.day2checkin_used)]
			    ], true);
			}
			else {
				day2checkinChart = new Highcharts.Chart({
					chart: {
						renderTo: 'day2checkin_chart',
						plotBackgroundColor: null,
						plotBorderWidth: null,
						plotShadow: false
					},
					title: {
						text: '報到狀態<br/>共 ' + dashboardData.total + ' 名會眾'
					},
					tooltip: {
						pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
					},
					plotOptions: {
						pie: {
							allowPointSelect: false,
							cursor: 'pointer',
							dataLabels: {
								enabled: true,
								formatter: function() {
									return this.y + ' ( ' + Math.round(this.percentage*100)/100 + '% )';
								},
								distance: -50
							},
							showInLegend: true
						}
					},
					series: [{
						type: 'pie',
						name: 'Percentage：',
						data: [
							{
								name: '已報到',
								y: dashboardData.day2checkin_used,
								sliced: true,
								selected: true
							},
							['未報到', (dashboardData.total - dashboardData.day2checkin_used)]
						]
					}]
				});
			}
		}


		var day2lunchChart;
		function draw_day2lunchChart() {
			if (!$.isEmptyObject(day2lunchChart)) {
				day2lunchChart.series[0].setData([
					{
						name: '已領取',
						y: dashboardData.day2lunch_used,
						sliced: true,
						selected: true
					},
					['未領取', (dashboardData.total - dashboardData.day2lunch_used)]
			    ], true);
			}
			else {
				day2lunchChart = new Highcharts.Chart({
					chart: {
						renderTo: 'day2lunch_chart',
						plotBackgroundColor: null,
						plotBorderWidth: null,
						plotShadow: false
					},
					title: {
						text: '午餐<br/>'
					},
					tooltip: {
						pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
					},
					plotOptions: {
						pie: {
							allowPointSelect: false,
							cursor: 'pointer',
							dataLabels: {
								enabled: true,
								formatter: function() {
									return this.y + ' ( ' + Math.round(this.percentage*100)/100 + '% )';
								},
								distance: -50
							},
							showInLegend: true
						}
					},
					series: [{
						type: 'pie',
						name: 'Percentage：',
						data: [
							{
								name: '已領取',
								y: dashboardData.day2lunch_used,
								sliced: true,
								selected: true
							},
							['未領取', (dashboardData.total - dashboardData.day2lunch_used)]
						]
					}]
				});
			}
		}


		$(document).ready(function () {
			$("#header").load("header.html");
			update();
		});

		setInterval(function () {
			update();
		}, 30000);
	</script>
	<style>
		body {
			padding-top: 50px;
		}
		.starter-template {
			padding: 40px 15px;
			text-align: center;
		}
		.modal-header {
			border-bottom: 0px;
		}

		.modal-footer {
			border-top: 0px;
		}
	</style>
	<body>
		<!-- Modal -->
		<div id="startModal" class="modal fade" role="dialog" data-keyboard="false" data-backdrop="static">
			<div class="modal-dialog">
				<!-- Modal content-->
				<div class="modal-content">
					<div class="modal-header">
						<h2 class="modal-title">Push...</h2>
					</div>
					<div class="modal-body">
						<div class="progress">
							<div class="progress-bar progress-bar-striped active" role="progressbar" style="width: 100%;"></div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div id="header"></div>
		<div class="container">
			<div class="starter-template">
				<p>Auto update every 30 sec.</p>
				<p><button type="button" onclick="update();">Update!</button></p>
			</div>
			<hr>
			<div class="row">
				<div class="starter-template">
					<h1>Day1</h1>
					<br/>
					<div id="day1checkin_chart" class="col-sm-4" style="min-width:200px;height:400px"></div>
					<div id="kit_chart" class="col-sm-4" style="min-width:200px;height:400px"></div>
					<div id="day1lunch_chart" class="col-sm-4" style="min-width:200px;height:400px"></div>
				</div>
			</div>
			<div class="row">
				<hr>
				<div class="starter-template">
					<h1>Day2</h1>
					<br/>
					<div id="day2checkin_chart" class="col-sm-4" style="min-width:200px;height:400px"></div>
					<div id="day2lunch_chart" class="col-sm-4" style="min-width:200px;height:400px"></div>
				</div>
			</div>
		</div><!-- /.container -->
	</body>
</html>
